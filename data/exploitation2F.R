# Exploitation to fishing mortality for West Coast fisheries
# 20180209 Crystal Tu

setwd("~/Desktop/fishsize_varpart/data/")
lifehist<-read.csv("lifehist_habitat.csv")
exploitation<-read.csv("exploitation.csv")
nSp <- ncol(exploitation)-1
nYear <- nrow(exploitation)

fishing <- matrix(data=NA,nrow=nYear,ncol=nSp)

for (i in 1:nYear) {
  for (j in 1:nSp) {
    M <- lifehist$M[j]
    u <- exploitation[i,j+1] 
    if (is.na(u) == TRUE){
      next()
    }
    f <- function(x) x*(1-exp(-(x+M)))-u*(x+M)
    f1 <- uniroot(f,c(0,0.5),extendInt="yes") 
    fishing[i,j]<-f1$root
  }
}
FishingMortality<-data.frame(YEAR=exploitation$YEAR,fishing)
colnames(FishingMortality)<-colnames(exploitation)
write.csv(FishingMortality,file="FishingMortality.csv",row.names = FALSE)
